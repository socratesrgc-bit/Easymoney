<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Financiero Personal</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --income: #2ecc71;
            --expense: #e74c3c;
            --background: #f8f9fa;
            --card-bg: #ffffff;
            --text: #333333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--primary);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .sync-section {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .user-info {
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .total-income {
            border-left: 5px solid var(--income);
        }
        
        .total-expenses {
            border-left: 5px solid var(--expense);
        }
        
        .net-balance {
            border-left: 5px solid var(--secondary);
        }
        
        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .card h3 {
            font-size: 2rem;
            margin: 15px 0;
        }
        
        .card p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .filter-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .filter-card select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 1rem;
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .action-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .action-card h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-income {
            background-color: var(--income);
        }
        
        .btn-income:hover {
            background-color: #27ae60;
        }
        
        .btn-expense {
            background-color: var(--expense);
        }
        
        .btn-expense:hover {
            background-color: #c0392b;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .btn-delete:hover {
            background-color: #c0392b;
        }

        .sync-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.9rem;
        }
        
        .sync-btn:hover {
            background: #2980b9;
        }
        
        .history {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .history-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .history-card h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .transaction-list {
            list-style-type: none;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info {
            display: flex;
            justify-content: space-between;
            flex-grow: 1;
            align-items: center;
        }
        
        .transaction-description {
            font-weight: 500;
        }
        
        .transaction-amount {
            font-weight: 600;
        }
        
        .income-amount {
            color: var(--income);
        }
        
        .expense-amount {
            color: var(--expense);
        }
        
        .transaction-date {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .dashboard, .filters, .actions, .history {
                grid-template-columns: 1fr;
            }
            
            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .transaction-info {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .btn-delete {
                align-self: flex-end;
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Control Financiero Personal</h1>
            <p class="user-info">Gestiona tus Ingresos y gastos en Soles Peruanos</p>
            <p class="user-info">Se√±or: <span id="user-name">Usuario</span></p>
            <p class="user-info">Soles (PER)</p>
        </header>
        
        <!-- Secci√≥n de sincronizaci√≥n -->
        <div class="sync-section">
            <h3>üîÑ Sincronizaci√≥n entre dispositivos</h3>
            <button class="sync-btn" onclick="exportData()">üì• Exportar Datos</button>
            <button class="sync-btn" onclick="importData()">üì§ Importar Datos</button>
            <button class="sync-btn" onclick="saveToFile()">üíæ Guardar Archivo</button>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Usa estos botones para transferir tus datos entre trabajo y casa
            </p>
        </div>
        
        <div class="dashboard">
            <div class="card total-income">
                <h2>TOTAL INGRESOS</h2>
                <h3 id="total-income">S/ 0.00</h3>
                <p>Ingresos del perfil de seleccionista</p>
            </div>
            
            <div class="card total-expenses">
                <h2>TOTAL GASTOS</h2>
                <h3 id="total-expenses">S/ 0.00</h3>
                <p>Causas del perfil de seleccionista</p>
            </div>
            
            <div class="card net-balance">
                <h2>BALANCE NETO</h2>
                <h3 id="net-balance">S/ 0.00</h3>
                <p>Recabado financiero neto</p>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-card">
                <h2>Filtro de Periodo</h2>
                <p>Seleccione el mes que desees visualizar</p>
                <select id="month-filter">
                    <option value="all">Todos los meses</option>
                    <option value="01">Enero</option>
                    <option value="02">Febrero</option>
                    <option value="03">Marzo</option>
                    <option value="04">Abril</option>
                    <option value="05">Mayo</option>
                    <option value="06">Junio</option>
                    <option value="07">Julio</option>
                    <option value="08">Agosto</option>
                    <option value="09">Septiembre</option>
                    <option value="10">Octubre</option>
                    <option value="11">Noviembre</option>
                    <option value="12">Diciembre</option>
                </select>
            </div>
        </div>
        
        <div class="actions">
            <div class="action-card">
                <h2>Agregar Ingreso</h2>
                <p>Registra nuevos ingresos</p>
                <div class="form-group">
                    <label for="income-description">Descripci√≥n</label>
                    <input type="text" id="income-description" placeholder="Ej: Salario, Ventas, Bonificaci√≥n">
                </div>
                <div class="form-group">
                    <label for="income-amount">Monto (S/)</label>
                    <input type="number" id="income-amount" placeholder="0.00" step="0.01" min="0">
                </div>
                <button class="btn btn-income" id="add-income">Agregar Ingreso</button>
            </div>
            
            <div class="action-card">
                <h2>An√°lisis con IA</h2>
                <p>Dise√±o Integrado Electrogr√°fico</p>
                <button class="btn" id="ai-analysis">Generar An√°lisis con IA</button>
                <p style="margin-top: 15px; font-size: 0.9rem;">Este sitio es el pueblo para obtener un an√°lisis inteligente de las finanzas.</p>
            </div>
            
            <div class="action-card">
                <h2>Agregar Gasto</h2>
                <p>Registra nuevos gastos</p>
                <div class="form-group">
                    <label for="expense-description">Descripci√≥n</label>
                    <input type="text" id="expense-description" placeholder="Ej: Alquiler, Comida, Transporte">
                </div>
                <div class="form-group">
                    <label for="expense-amount">Monto (S/)</label>
                    <input type="number" id="expense-amount" placeholder="0.00" step="0.01" min="0">
                </div>
                <button class="btn btn-expense" id="add-expense">Agregar Gasto</button>
            </div>
            
            <div class="action-card">
                <h2>Exportar Datos</h2>
                <p>Bases en la informaci√≥n</p>
                <button class="btn" id="export-csv">Descargar CSV</button>
                <p style="margin-top: 15px; font-size: 0.9rem;">Se√±ora https://escalador.el comiso.csi/ /composiciones/ sms</p>
            </div>
        </div>
        
        <div class="history">
            <div class="history-card">
                <h2>Historial de Ingresos</h2>
                <ul class="transaction-list" id="income-history">
                    <!-- Los ingresos se agregar√°n aqu√≠ din√°micamente -->
                </ul>
            </div>
            
            <div class="history-card">
                <h2>Historial de Gastos</h2>
                <ul class="transaction-list" id="expense-history">
                    <!-- Los gastos se agregar√°n aqu√≠ din√°micamente -->
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal para An√°lisis con IA -->
    <div class="modal" id="ai-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>An√°lisis con IA</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div id="ai-analysis-content">
                <!-- El contenido del an√°lisis se mostrar√° aqu√≠ -->
            </div>
        </div>
    </div>

    <script>
        // Cargar datos desde localStorage o usar datos vac√≠os
        let transactions = JSON.parse(localStorage.getItem('financialTransactions')) || [];

        // FUNCI√ìN CORREGIDA PARA OBTENER FECHA ACTUAL
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // FUNCI√ìN MEJORADA PARA FORMATEAR FECHA
        function formatDate(dateString) {
            try {
                // Si la fecha es inv√°lida, mostrar fecha actual
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return new Date().toLocaleDateString('es-PE');
                }
                
                const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                return date.toLocaleDateString('es-PE', options);
            } catch (error) {
                // Si hay error, devolver fecha actual
                return new Date().toLocaleDateString('es-PE');
            }
        }

        // FUNCI√ìN PARA CORREGIR FECHAS EXISTENTES (se ejecuta al cargar)
        function fixExistingDates() {
            let needsFix = false;
            const currentDate = getCurrentDate();
            
            transactions.forEach(transaction => {
                // Si la fecha es del futuro (2025) o inv√°lida, corregirla
                if (transaction.date && transaction.date.startsWith('2025')) {
                    transaction.date = currentDate;
                    needsFix = true;
                }
            });
            
            if (needsFix) {
                saveToLocalStorage();
                console.log('Fechas corregidas autom√°ticamente');
            }
        }

        // Guardar datos en localStorage
        function saveToLocalStorage() {
            localStorage.setItem('financialTransactions', JSON.stringify(transactions));
        }

        // Elementos del DOM
        const totalIncomeElement = document.getElementById('total-income');
        const totalExpensesElement = document.getElementById('total-expenses');
        const netBalanceElement = document.getElementById('net-balance');
        const incomeHistoryElement = document.getElementById('income-history');
        const expenseHistoryElement = document.getElementById('expense-history');
        const addIncomeButton = document.getElementById('add-income');
        const addExpenseButton = document.getElementById('add-expense');
        const aiAnalysisButton = document.getElementById('ai-analysis');
        const exportCsvButton = document.getElementById('export-csv');
        const monthFilter = document.getElementById('month-filter');
        const aiModal = document.getElementById('ai-modal');
        const closeModalButton = document.querySelector('.close-btn');
        const aiAnalysisContent = document.getElementById('ai-analysis-content');

        // Inicializar la aplicaci√≥n
        function init() {
            fixExistingDates(); // Corregir fechas al cargar
            updateDashboard();
            renderTransactionHistory();
            setupEventListeners();
        }

        // Configurar event listeners
        function setupEventListeners() {
            addIncomeButton.addEventListener('click', addIncome);
            addExpenseButton.addEventListener('click', addExpense);
            aiAnalysisButton.addEventListener('click', showAiAnalysis);
            exportCsvButton.addEventListener('click', exportToCsv);
            monthFilter.addEventListener('change', filterByMonth);
            closeModalButton.addEventListener('click', () => {
                aiModal.style.display = 'none';
            });
            
            // Cerrar modal al hacer clic fuera del contenido
            window.addEventListener('click', (event) => {
                if (event.target === aiModal) {
                    aiModal.style.display = 'none';
                }
            });
        }

        // Actualizar el dashboard con los totales
        function updateDashboard() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const netBalance = totalIncome - totalExpenses;
            
            totalIncomeElement.textContent = `S/ ${totalIncome.toFixed(2)}`;
            totalExpensesElement.textContent = `S/ ${totalExpenses.toFixed(2)}`;
            netBalanceElement.textContent = `S/ ${netBalance.toFixed(2)}`;
        }

        // Renderizar el historial de transacciones
        function renderTransactionHistory() {
            // Limpiar listas
            incomeHistoryElement.innerHTML = '';
            expenseHistoryElement.innerHTML = '';
            
            // Obtener el mes seleccionado
            const selectedMonth = monthFilter.value;
            
            // Filtrar transacciones por mes si es necesario
            let filteredTransactions = transactions;
            if (selectedMonth !== 'all') {
                filteredTransactions = transactions.filter(t => {
                    const transactionMonth = t.date.split('-')[1];
                    return transactionMonth === selectedMonth;
                });
            }
            
            // Renderizar ingresos
            const incomes = filteredTransactions.filter(t => t.type === 'income');
            if (incomes.length === 0) {
                incomeHistoryElement.innerHTML = '<li class="transaction-item">No hay ingresos registrados</li>';
            } else {
                incomes.forEach(income => {
                    const li = document.createElement('li');
                    li.className = 'transaction-item';
                    li.innerHTML = `
                        <div class="transaction-info">
                            <div>
                                <div class="transaction-description">${income.description}</div>
                                <div class="transaction-date">${formatDate(income.date)}</div>
                            </div>
                            <span class="transaction-amount income-amount">S/ ${income.amount.toFixed(2)}</span>
                        </div>
                        <button class="btn-delete" data-id="${income.id}">Eliminar</button>
                    `;
                    incomeHistoryElement.appendChild(li);
                });
            }
            
            // Renderizar gastos
            const expenses = filteredTransactions.filter(t => t.type === 'expense');
            if (expenses.length === 0) {
                expenseHistoryElement.innerHTML = '<li class="transaction-item">No hay gastos registrados</li>';
            } else {
                expenses.forEach(expense => {
                    const li = document.createElement('li');
                    li.className = 'transaction-item';
                    li.innerHTML = `
                        <div class="transaction-info">
                            <div>
                                <div class="transaction-description">${expense.description}</div>
                                <div class="transaction-date">${formatDate(expense.date)}</div>
                            </div>
                            <span class="transaction-amount expense-amount">S/ ${expense.amount.toFixed(2)}</span>
                        </div>
                        <button class="btn-delete" data-id="${expense.id}">Eliminar</button>
                    `;
                    expenseHistoryElement.appendChild(li);
                });
            }
            
            // Agregar event listeners a los botones de eliminar
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.getAttribute('data-id'));
                    deleteTransaction(id);
                });
            });
        }

        // Agregar un nuevo ingreso (CORREGIDO)
        function addIncome() {
            const description = document.getElementById('income-description').value.trim();
            const amount = parseFloat(document.getElementById('income-amount').value);
            
            if (!description || isNaN(amount) || amount <= 0) {
                alert('Por favor, ingresa una descripci√≥n y un monto v√°lido');
                return;
            }
            
            const newIncome = {
                id: Date.now(),
                type: 'income',
                description,
                amount,
                date: getCurrentDate()  // FECHA CORREGIDA
            };
            
            transactions.push(newIncome);
            saveToLocalStorage();
            updateDashboard();
            renderTransactionHistory();
            
            // Limpiar formulario
            document.getElementById('income-description').value = '';
            document.getElementById('income-amount').value = '';
            
            alert('Ingreso agregado correctamente');
        }

        // Agregar un nuevo gasto (CORREGIDO)
        function addExpense() {
            const description = document.getElementById('expense-description').value.trim();
            const amount = parseFloat(document.getElementById('expense-amount').value);
            
            if (!description || isNaN(amount) || amount <= 0) {
                alert('Por favor, ingresa una descripci√≥n y un monto v√°lido');
                return;
            }
            
            const newExpense = {
                id: Date.now(),
                type: 'expense',
                description,
                amount,
                date: getCurrentDate()  // FECHA CORREGIDA
            };
            
            transactions.push(newExpense);
            saveToLocalStorage();
            updateDashboard();
            renderTransactionHistory();
            
            // Limpiar formulario
            document.getElementById('expense-description').value = '';
            document.getElementById('expense-amount').value = '';
            
            alert('Gasto agregado correctamente');
        }

        // Eliminar una transacci√≥n
        function deleteTransaction(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta transacci√≥n?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveToLocalStorage();
                updateDashboard();
                renderTransactionHistory();
                alert('Transacci√≥n eliminada correctamente');
            }
        }

        // Filtrar transacciones por mes
        function filterByMonth() {
            renderTransactionHistory();
        }

        // Mostrar an√°lisis con IA
        function showAiAnalysis() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const netBalance = totalIncome - totalExpenses;
            
            let analysis = `
                <h3>An√°lisis Financiero Inteligente</h3>
                <p><strong>Resumen General:</strong></p>
                <ul>
                    <li>Ingresos totales: S/ ${totalIncome.toFixed(2)}</li>
                    <li>Gastos totales: S/ ${totalExpenses.toFixed(2)}</li>
                    <li>Balance neto: S/ ${netBalance.toFixed(2)}</li>
                    <li>Total de transacciones: ${transactions.length}</li>
                </ul>
            `;
            
            if (netBalance > 0) {
                analysis += `<p><strong>Recomendaci√≥n:</strong> ‚úÖ Tienes un balance positivo. Considera invertir el excedente para generar m√°s ingresos.</p>`;
            } else if (netBalance < 0) {
                analysis += `<p><strong>Alerta:</strong> ‚ö†Ô∏è Tienes un balance negativo. Revisa tus gastos y considera reducirlos.</p>`;
            } else {
                analysis += `<p><strong>Observaci√≥n:</strong> üîÑ Tus ingresos y gastos est√°n equilibrados.</p>`;
            }
            
            // An√°lisis de categor√≠as de gastos
            const expenseCategories = {};
            transactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expenseCategories[t.description] = (expenseCategories[t.description] || 0) + t.amount;
                });
            
            if (Object.keys(expenseCategories).length > 0) {
                analysis += `<p><strong>Distribuci√≥n de Gastos:</strong></p><ul>`;
                for (const [category, amount] of Object.entries(expenseCategories)) {
                    const percentage = totalExpenses > 0 ? ((amount / totalExpenses) * 100).toFixed(1) : '0';
                    analysis += `<li>${category}: S/ ${amount.toFixed(2)} (${percentage}%)</li>`;
                }
                analysis += `</ul>`;
            }
            
            // An√°lisis de tendencia mensual
            const monthlyData = {};
            transactions.forEach(t => {
                const month = t.date.substring(0, 7); // YYYY-MM
                if (!monthlyData[month]) {
                    monthlyData[month] = { income: 0, expense: 0 };
                }
                if (t.type === 'income') {
                    monthlyData[month].income += t.amount;
                } else {
                    monthlyData[month].expense += t.amount;
                }
            });
            
            if (Object.keys(monthlyData).length > 1) {
                analysis += `<p><strong>Tendencia Mensual:</strong></p><ul>`;
                Object.keys(monthlyData).sort().forEach(month => {
                    const data = monthlyData[month];
                    analysis += `<li>${month}: Ingresos S/ ${data.income.toFixed(2)} - Gastos S/ ${data.expense.toFixed(2)}</li>`;
                });
                analysis += `</ul>`;
            }
            
            aiAnalysisContent.innerHTML = analysis;
            aiModal.style.display = 'flex';
        }

        // Exportar datos a CSV
        function exportToCsv() {
            let csvContent = "Tipo,Descripci√≥n,Monto,Fecha\n";
            
            transactions.forEach(transaction => {
                csvContent += `${transaction.type},${transaction.description},${transaction.amount},${transaction.date}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'finanzas_personales.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Archivo CSV descargado correctamente');
        }

        // Funciones de sincronizaci√≥n
        function exportData() {
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'datos_financieros.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('Datos exportados. Guarda este archivo y ll√©valo contigo.');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        transactions = importedData;
                        localStorage.setItem('financialTransactions', JSON.stringify(transactions));
                        updateDashboard();
                        renderTransactionHistory();
                        alert('Datos importados correctamente!');
                    } catch (error) {
                        alert('Error al importar datos. Verifica el archivo.');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function saveToFile() {
            const htmlContent = `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Financiero Personal</title>
    <style>
        ${document.querySelector('style').innerHTML}
    </style>
</head>
<body>
    ${document.querySelector('.container').outerHTML}
    <script>
        ${document.querySelector('script').innerHTML}
    <\/script>
</body>
</html>`;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'app_finanzas_completa.html';
            link.click();
            
            alert('Aplicaci√≥n guardada. Lleva este archivo a cualquier computadora.');
        }

        // Inicializar la aplicaci√≥n cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
